#!/bin/sh
. "$(dirname "$0")/_/husky.sh"

# Check for test results and logs that shouldn't be committed
BLOCKED_FILES=$(git diff --cached --name-only | grep -E 'test-results/|deep-link-test-results/|branch-test-logs/|\.log$')

if [ ! -z "$BLOCKED_FILES" ]; then
  echo "Error: Attempting to commit files that should not be versioned:"
  echo "$BLOCKED_FILES"
  echo "\nThese files should be added to .gitignore instead."
  exit 1
fi

# Run lint-staged
npx lint-staged

# Run format check
npm run format:check || {
  echo "Error: Code formatting issues found. Run 'npm run format' to fix."
  exit 1
}

# Run TypeScript check
npm run typescript || {
  echo "Error: TypeScript errors found. Please fix them before committing."
  exit 1
}
